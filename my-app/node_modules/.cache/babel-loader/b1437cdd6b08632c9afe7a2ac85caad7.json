{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.matchedData = void 0;\n\nconst _ = require(\"lodash\");\n\nconst base_1 = require(\"./base\");\n\nfunction matchedData(req) {\n  let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const internalReq = req;\n  const fieldExtractor = createFieldExtractor(options.includeOptionals !== true);\n  const validityFilter = createValidityFilter(options.onlyValidData);\n  const locationFilter = createLocationFilter(options.locations);\n  return _(internalReq[base_1.contextsKey]).flatMap(fieldExtractor).filter(validityFilter).map(field => field.instance).filter(locationFilter).reduce((state, instance) => _.set(state, instance.path, instance.value), {}).valueOf();\n}\n\nexports.matchedData = matchedData;\n\nfunction createFieldExtractor(removeOptionals) {\n  return context => {\n    const instances = context.getData({\n      requiredOnly: removeOptionals\n    });\n    return instances.map(instance => ({\n      instance,\n      context\n    }));\n  };\n}\n\nfunction createValidityFilter() {\n  let onlyValidData = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n  return !onlyValidData ? () => true : field => {\n    const hasError = field.context.errors.some(error => error.location === field.instance.location && error.param === field.instance.path);\n    return !hasError;\n  };\n}\n\nfunction createLocationFilter() {\n  let locations = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  // No locations mean all locations\n  const allLocations = locations.length === 0;\n  return allLocations ? () => true : field => locations.includes(field.location);\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","matchedData","_","require","base_1","req","options","internalReq","fieldExtractor","createFieldExtractor","includeOptionals","validityFilter","createValidityFilter","onlyValidData","locationFilter","createLocationFilter","locations","contextsKey","flatMap","filter","map","field","instance","reduce","state","set","path","valueOf","removeOptionals","context","instances","getData","requiredOnly","hasError","errors","some","error","location","param","allLocations","length","includes"],"sources":["E:/library/library_management/node_modules/express-validator/src/matched-data.js"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.matchedData = void 0;\r\nconst _ = require(\"lodash\");\r\nconst base_1 = require(\"./base\");\r\nfunction matchedData(req, options = {}) {\r\n    const internalReq = req;\r\n    const fieldExtractor = createFieldExtractor(options.includeOptionals !== true);\r\n    const validityFilter = createValidityFilter(options.onlyValidData);\r\n    const locationFilter = createLocationFilter(options.locations);\r\n    return _(internalReq[base_1.contextsKey])\r\n        .flatMap(fieldExtractor)\r\n        .filter(validityFilter)\r\n        .map(field => field.instance)\r\n        .filter(locationFilter)\r\n        .reduce((state, instance) => _.set(state, instance.path, instance.value), {})\r\n        .valueOf();\r\n}\r\nexports.matchedData = matchedData;\r\nfunction createFieldExtractor(removeOptionals) {\r\n    return (context) => {\r\n        const instances = context.getData({ requiredOnly: removeOptionals });\r\n        return instances.map((instance) => ({ instance, context }));\r\n    };\r\n}\r\nfunction createValidityFilter(onlyValidData = true) {\r\n    return !onlyValidData\r\n        ? () => true\r\n        : (field) => {\r\n            const hasError = field.context.errors.some(error => error.location === field.instance.location && error.param === field.instance.path);\r\n            return !hasError;\r\n        };\r\n}\r\nfunction createLocationFilter(locations = []) {\r\n    // No locations mean all locations\r\n    const allLocations = locations.length === 0;\r\n    return allLocations ? () => true : (field) => locations.includes(field.location);\r\n}\r\n"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,WAAR,GAAsB,KAAK,CAA3B;;AACA,MAAMC,CAAC,GAAGC,OAAO,CAAC,QAAD,CAAjB;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAtB;;AACA,SAASF,WAAT,CAAqBI,GAArB,EAAwC;EAAA,IAAdC,OAAc,uEAAJ,EAAI;EACpC,MAAMC,WAAW,GAAGF,GAApB;EACA,MAAMG,cAAc,GAAGC,oBAAoB,CAACH,OAAO,CAACI,gBAAR,KAA6B,IAA9B,CAA3C;EACA,MAAMC,cAAc,GAAGC,oBAAoB,CAACN,OAAO,CAACO,aAAT,CAA3C;EACA,MAAMC,cAAc,GAAGC,oBAAoB,CAACT,OAAO,CAACU,SAAT,CAA3C;EACA,OAAOd,CAAC,CAACK,WAAW,CAACH,MAAM,CAACa,WAAR,CAAZ,CAAD,CACFC,OADE,CACMV,cADN,EAEFW,MAFE,CAEKR,cAFL,EAGFS,GAHE,CAGEC,KAAK,IAAIA,KAAK,CAACC,QAHjB,EAIFH,MAJE,CAIKL,cAJL,EAKFS,MALE,CAKK,CAACC,KAAD,EAAQF,QAAR,KAAqBpB,CAAC,CAACuB,GAAF,CAAMD,KAAN,EAAaF,QAAQ,CAACI,IAAtB,EAA4BJ,QAAQ,CAACtB,KAArC,CAL1B,EAKuE,EALvE,EAMF2B,OANE,EAAP;AAOH;;AACD5B,OAAO,CAACE,WAAR,GAAsBA,WAAtB;;AACA,SAASQ,oBAAT,CAA8BmB,eAA9B,EAA+C;EAC3C,OAAQC,OAAD,IAAa;IAChB,MAAMC,SAAS,GAAGD,OAAO,CAACE,OAAR,CAAgB;MAAEC,YAAY,EAAEJ;IAAhB,CAAhB,CAAlB;IACA,OAAOE,SAAS,CAACV,GAAV,CAAeE,QAAD,KAAe;MAAEA,QAAF;MAAYO;IAAZ,CAAf,CAAd,CAAP;EACH,CAHD;AAIH;;AACD,SAASjB,oBAAT,GAAoD;EAAA,IAAtBC,aAAsB,uEAAN,IAAM;EAChD,OAAO,CAACA,aAAD,GACD,MAAM,IADL,GAEAQ,KAAD,IAAW;IACT,MAAMY,QAAQ,GAAGZ,KAAK,CAACQ,OAAN,CAAcK,MAAd,CAAqBC,IAArB,CAA0BC,KAAK,IAAIA,KAAK,CAACC,QAAN,KAAmBhB,KAAK,CAACC,QAAN,CAAee,QAAlC,IAA8CD,KAAK,CAACE,KAAN,KAAgBjB,KAAK,CAACC,QAAN,CAAeI,IAAhH,CAAjB;IACA,OAAO,CAACO,QAAR;EACH,CALL;AAMH;;AACD,SAASlB,oBAAT,GAA8C;EAAA,IAAhBC,SAAgB,uEAAJ,EAAI;EAC1C;EACA,MAAMuB,YAAY,GAAGvB,SAAS,CAACwB,MAAV,KAAqB,CAA1C;EACA,OAAOD,YAAY,GAAG,MAAM,IAAT,GAAiBlB,KAAD,IAAWL,SAAS,CAACyB,QAAV,CAAmBpB,KAAK,CAACgB,QAAzB,CAA9C;AACH"},"metadata":{},"sourceType":"script"}